---
title: "Final Assignment SLE 777"
author: "Ashith Sujay Kumar"
output:
  html_document:
    toc: true
    toc_depth: 2
    theme: cosmo
---

```{r}
# Part 1

# Load required libraries quietly
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

suppressPackageStartupMessages({
  library(seqinr)
  library(R.utils)
})

```

```{r}
# # Read gene expression data
gene_url <- "https://raw.githubusercontent.com/ghazkha/Assessment4/refs/heads/main/gene_expression.tsv"
gene_expression <- read.table(gene_url, header = TRUE, sep = "\t", row.names = 1)

# Ensure numeric values
gene_expression[] <- lapply(gene_expression, as.numeric)

# Add mean expression column
gene_expression$MeanExpression <- rowMeans(gene_expression, na.rm = TRUE)

```

```{r}
# Question 1: Show first six rows
head(gene_expression)
# Display first six rows of gene expression data to inspect dataset structure.
# Answer: Successfully displayed the first six rows showing expression values and computed mean expression.
```

```{r}
# Question 2: List the 10 genes with highest mean expression
# Top 10 genes by mean expression
top10_genes <- head(gene_expression[order(-gene_expression$MeanExpression), ], 10)
top10_genes
# Identify the top 10 genes with the highest mean expression across samples.
# Answer: Listed top 10 genes, with ENSG00000198804.2_MT-CO1 having the highest mean expression (~529,317).
#
```

```{r}
# Question 3: Show first six genes with mean expression
head(gene_expression)
# Answer: Displayed first six genes showing expression values and the new mean expression column.
```

```{r}
# Question 4: Count genes with mean expression < 10
# Count genes with mean expression < 10
num_low_genes <- sum(gene_expression$MeanExpression < 10)
num_low_genes
# Count genes with mean expression less than 10 to assess low expression genes.
# Answer: Found 35,988 genes with mean expression below 10.
```

```{r}
# Question 5: Histogram of mean values
# Histogram of Mean Gene Expression (Log Scale)
hist(
  log10(gene_expression$MeanExpression + 1), 
  main = "Distribution of Mean Gene Expression (Log10 Scale)", 
  xlab = "Log10(Mean Expression + 1)", 
  col = "lightblue", 
  breaks = 30
)
# Create a histogram (log10 scale) of mean gene expression to visualize distribution.
# Answer: Histogram shows most genes have low expression, with a few highly expressed genes.

```

```{r}
# Question 6: Read growth_data.csv file directly from GitHub
# Read growth data
growth_url <- "https://raw.githubusercontent.com/ghazkha/Assessment4/refs/heads/main/growth_data.csv"
growth_data <- read.csv(growth_url, stringsAsFactors = FALSE)

# Assign Start and End values directly from correct columns
growth_data$Start <- as.numeric(growth_data$Circumf_2005_cm)
growth_data$End   <- as.numeric(growth_data$Circumf_2020_cm)

# Remove rows with missing data
growth_data <- growth_data[complete.cases(growth_data$Start, growth_data$End, growth_data$Site), ]

# Convert Site to factor
growth_data$Site <- as.factor(growth_data$Site)

# Check cleaned data
head(growth_data)

#  Read and clean growth data for trees from CSV; add start/end circumference columns.
# Answer: Data cleaned; missing values removed; start/end circumferences assigned.

```


```{r}
# Question 7: Mean & SD for Start and End circumferences by Site
tapply(growth_data$Start, growth_data$Site, function(x) c(mean = mean(x), sd = sd(x)))
tapply(growth_data$End, growth_data$Site, function(x) c(mean = mean(x), sd = sd(x)))

# Calculate mean and standard deviation of start and end circumferences grouped by site.
# Answer: Northeast site trees larger at both start and end; higher variation at end.

```

```{r}
# Question 8: Box plot of circumference
boxplot(Start ~ Site, data = growth_data,
        main = "Tree Circumference at Start by Site",
        ylab = "Circumference (cm)",
        col = "lightgreen")

boxplot(End ~ Site, data = growth_data,
        main = "Tree Circumference at End by Site",
        ylab = "Circumference (cm)",
        col = "lightcoral")
# Boxplot comparison of start and end circumferences by site.
# Answer: Clear differences in growth patterns by site.

```

```{r}
# Question 9: Mean growth over last 10 years
# Growth over 10 years
growth_data$growth10yr <- growth_data$End - growth_data$Start
tapply(growth_data$growth10yr, growth_data$Site, mean)
# Calculate mean growth over 10 years for each site.
# Answer: Northeast site had higher mean growth (48.936 cm) than southwest (40.734 cm).


```

```{r}
# Question 10: t.test for difference between sites
t.test(growth10yr ~ Site, data = growth_data)
# Perform t-test to compare growth between sites.
# Answer: p-value ~0.059 suggests difference is marginally non-significant.

# Count coding sequences in each organism’s genome.
# Answer: E. coli has 4,239 CDS; Anaerococcus tetradius has 1,836 CDS.

```

```{r}
#Part 2 — Biological Sequence Diversity

library(R.utils)
library(seqinr)


# Step 1 — Download & decompress E. coli CDS file

ecoli_URL <- "https://ftp.ensemblgenomes.ebi.ac.uk/pub/bacteria/release-62/fasta/bacteria_0_collection/escherichia_coli_str_k_12_substr_mg1655_gca_000005845/cds/Escherichia_coli_str_k_12_substr_mg1655_gca_000005845.ASM584v2.cds.all.fa.gz"
download.file(ecoli_URL, destfile = "ecoli_cds.fa.gz", mode = "wb")
gunzip("ecoli_cds.fa.gz", remove = FALSE, overwrite = TRUE)
ecoli_fasta <- read.fasta(file = "ecoli_cds.fa")

```

```{r}
# Step 2 — Download & decompress Organism CDS file

org_URL <- "https://ftp.ensemblgenomes.ebi.ac.uk/pub/bacteria/release-62/fasta/bacteria_12_collection/anaerococcus_tetradius_gca_001546165/cds/Anaerococcus_tetradius_gca_001546165.ASM154616v1.cds.all.fa.gz"
download.file(org_URL, destfile = "organism_cds.fa.gz", mode = "wb")
gunzip("organism_cds.fa.gz", remove = FALSE, overwrite = TRUE)
organism_fasta <- read.fasta(file = "organism_cds.fa")

```

```{r}

# Question 1 — Count coding sequences
num_cds <- data.frame(
  Organism = c("E. coli", "Anaerococcus tetradius"),
  CDS_Count = c(length(ecoli_fasta), length(organism_fasta))
)
num_cds
# Count coding sequences in each organism’s genome.
# Answer: E. coli has 4,239 CDS; Anaerococcus tetradius has 1,836 CDS.


```

```{r}
# Question 2 — Total coding DNA length
total_coding <- data.frame(
  Organism = c("E. coli", "Anaerococcus tetradius"),
  Total_Coding_Length = c(sum(sapply(ecoli_fasta, length)), sum(sapply(organism_fasta, length)))
)
total_coding
# Compute total coding DNA length for each organism.
# Answer: E. coli has ~3.98 Mbp coding DNA; Anaerococcus tetradius has ~1.76 Mbp.

```

```{r}
# Question 3 — Coding sequence length distribution
ecoli_lengths <- sapply(ecoli_fasta, length)
org_lengths <- sapply(organism_fasta, length)

boxplot(ecoli_lengths, org_lengths,
        names = c("E. coli", "Anaerococcus tetradius"),
        main = "Coding Sequence Length Comparison",
        ylab = "Length (bp)",
        col = c("lightblue", "lightgreen"))

mean(ecoli_lengths); median(ecoli_lengths)
mean(org_lengths); median(org_lengths)
# Compare coding sequence length distributions with boxplots.
# Answer: Median lengths similar (~831 bp vs. ~804 bp); means slightly different.

```

```{r}
# Question 4 — DNA base frequencies

# Translate CDS into protein sequences
prot_ecoli <- lapply(ecoli_fasta, function(seq) translate(getSequence(seq)))
prot_org   <- lapply(organism_fasta, function(seq) translate(getSequence(seq)))

# Get unique amino acids (exclude stop codon "*")
aa <- unique(unlist(prot_ecoli))
aa <- aa[aa != "*"]

# Amino acid frequencies
aafreq_ecoli <- count(unlist(prot_ecoli), wordsize = 1, alphabet = aa)
aafreq_org   <- count(unlist(prot_org),   wordsize = 1, alphabet = aa)

# Replace missing frequencies with 0
aafreq_ecoli[is.na(aafreq_ecoli)] <- 0
aafreq_org[is.na(aafreq_org)] <- 0

# Plot amino acid frequencies for E. coli
barplot(as.numeric(aafreq_ecoli),
        names.arg = names(aafreq_ecoli),
        las = 2,
        main = "E. coli Amino Acid Frequencies",
        ylab = "Count",
        col = "lightblue")

# Plot amino acid frequencies for Anaerococcus tetradius
barplot(as.numeric(aafreq_org),
        names.arg = names(aafreq_org),
        las = 2,
        main = "Anaerococcus tetradius Amino Acid Frequencies",
        ylab = "Count",
        col = "lightgreen")
# Translate CDS to proteins and compute amino acid frequencies.
# Answer: Amino acid usage profiles plotted; notable differences between organisms.#

```

```{r}
# Question 5 — Codon usage

# Sum codon usage across all sequences
ecoli_codons <- rowSums(sapply(ecoli_fasta, uco))
org_codons   <- rowSums(sapply(organism_fasta, uco))

# Ensure codons are in the same order, fill missing codons with 0
all_codons <- sort(unique(c(names(ecoli_codons), names(org_codons))))
ecoli_codons <- ecoli_codons[all_codons]
org_codons   <- org_codons[all_codons]
ecoli_codons[is.na(ecoli_codons)] <- 0
org_codons[is.na(org_codons)] <- 0

# Combine into matrix for plotting
codon_matrix <- rbind(as.numeric(ecoli_codons), as.numeric(org_codons))

# Plot codon usage
barplot(codon_matrix,
        beside = TRUE,
        legend = c("E. coli", "Anaerococcus tetradius"),
        main = "Codon Usage Comparison",
        names.arg = all_codons,
        col = c("lightblue", "lightgreen"),
        las = 2,  # rotate codon labels
        cex.names = 0.7,
        ylab = "Frequency")
# Compute and compare codon usage for each organism.
# Answer: Codon usage patterns differ; visualized in barplot for comparison.


```

```{r}
# Question 6 — K-mer analysis

# Function to generate all k-mers of length k from a list of sequences
kmer_count <- function(seqs, k) {
  unlist(lapply(seqs, function(seq) {
    sapply(1:(length(seq) - k + 1), function(i) paste(seq[i:(i+k-1)], collapse = ""))
  }))
}

# Set up plotting area: 3 rows (k=3,4,5) × 2 columns (over- and under-represented)
par(mfrow = c(3, 2), mar = c(4, 4, 2, 1))  

# Loop over k-mer lengths: 3, 4, 5
for (k in c(3, 4, 5)) {
  
  # Count all k-mers for both organisms
  ecoli_kmers <- table(kmer_count(ecoli_fasta, k))
  org_kmers   <- table(kmer_count(organism_fasta, k))
  
  # Loop for both Over-represented and Under-represented k-mers
  for (type in c("Over", "Under")) {
    
    # Select top or bottom 10 k-mers for the organism
    kmers <- if (type == "Over") {
      head(sort(org_kmers, decreasing = TRUE), 10) 
    } else {
      head(sort(org_kmers, decreasing = FALSE), 10)
    }
    
    # Create a barplot comparing organism vs E. coli k-mer frequencies
    barplot(rbind(as.numeric(kmers), as.numeric(ecoli_kmers[names(kmers)])),
            beside = TRUE,
            names.arg = names(kmers),
            col = c("lightgreen", "lightblue"),
            las = 2, cex.names = 0.7,
            main = paste0("k=", k, " ", type, "-represented k-mers"),
            ylab = "Frequency")
    
    # Add legend
    legend("topright", legend = c("Organism", "E. coli"), fill = c("lightgreen", "lightblue"), cex = 0.7)
  }
}
# Perform k-mer analysis (k = 3, 4, 5) to find over- and under-represented motifs.
# Answer: Over- and under-represented k-mers identified; differences between organisms evident.
```









